---
title: "Data 621 - HW-1 - Trial-1"
author: "Deepak Mongia"
date: "2/25/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

In this homework assignment, we are exploring, analyzing and modelling a data set containing approximately 2200 records. Each record represents a professional baseball team from the years 1871 to 2006 inclusive. Each record has the performance of the team for the given year, with all of the statistics adjusted to match the performance of a 162 game season.


### Loading required libraries
```{r}
#install.packages("mice")
#install.packages("cowplot")

library(ggplot2)
library(mice)
library(tidyverse)
library(cowplot)
library(VIM)

```

#### Loading data

```{r}
moneyball_df <- read.csv("D:\\MS Data Science\\CUNY\\CUNY\\CUNY MSDS\\Spring 2020\\DATA 621\\Homework-1\\moneyball-training-data.csv", header = TRUE,
                         row.names = 1)

str(moneyball_df)
dim(moneyball_df)
colnames(moneyball_df)
summary(moneyball_df)

```

Missing data in columns:
```{r}
### Count by features
apply(moneyball_df, 2, function(x) length(which(is.na(x))))

### Per centage by features
pMiss <- function(x) {sum(is.na(x)) / length(x) * 100}
apply(moneyball_df, 2, pMiss)

```


As the feature - TEAM_BATTING_HBP is missing data for 2085 observations which is 91% of the data, it is good to remove this feature from our dataset.
Also checking by drawing a scatter plot between this feature and target wins
```{r}
gs6b <- ggplot(data = moneyball_df, aes(x = TEAM_BATTING_HBP, y = TARGET_WINS)) +
  geom_point() + geom_smooth()
gs6b
```

Plotting Scatter plots for the dependent variable against each of the independent variable:
```{r}
### Drawing some plots
gs1 <- ggplot(data = moneyball_df, aes(x = TEAM_BATTING_H, y = TARGET_WINS)) +
  geom_point() + geom_smooth()

gs2 <- ggplot(data = moneyball_df, aes(x = TEAM_BATTING_2B, y = TARGET_WINS)) +
  geom_point() + geom_smooth()

gs3 <- ggplot(data = moneyball_df, aes(x = TEAM_BATTING_3B, y = TARGET_WINS)) +
  geom_point() + geom_smooth()

gs4 <- ggplot(data = moneyball_df, aes(x = TEAM_BATTING_HR, y = TARGET_WINS)) +
  geom_point() + geom_smooth()

gs5 <- ggplot(data = moneyball_df, aes(x = TEAM_BATTING_BB, y = TARGET_WINS)) +
  geom_point() + geom_smooth()

gs6 <- ggplot(data = moneyball_df, aes(x = TEAM_BATTING_HBP, y = TARGET_WINS)) +
  geom_point() + geom_smooth()

gs7 <- ggplot(data = moneyball_df, aes(x = TEAM_BATTING_SO, y = TARGET_WINS)) +
  geom_point() + geom_smooth()

gs8 <- ggplot(data = moneyball_df, aes(x = TEAM_BASERUN_SB, y = TARGET_WINS)) +
  geom_point() + geom_smooth()

gs9 <- ggplot(data = moneyball_df, aes(x = TEAM_BASERUN_CS, y = TARGET_WINS)) +
  geom_point() + geom_smooth()

gs10 <- ggplot(data = moneyball_df, aes(x = TEAM_FIELDING_E, y = TARGET_WINS)) +
  geom_point() + geom_smooth()

gs11 <- ggplot(data = moneyball_df, aes(x = TEAM_FIELDING_DP, y = TARGET_WINS)) +
  geom_point() + geom_smooth()

gs12 <- ggplot(data = moneyball_df, aes(x = TEAM_PITCHING_BB, y = TARGET_WINS)) +
  geom_point() + geom_smooth()

gs13 <- ggplot(data = moneyball_df, aes(x = TEAM_PITCHING_H, y = TARGET_WINS)) +
  geom_point() + geom_smooth()

gs14 <- ggplot(data = moneyball_df, aes(x = TEAM_PITCHING_HR, y = TARGET_WINS)) +
  geom_point() + geom_smooth()

gs15 <- ggplot(data = moneyball_df, aes(x = TEAM_PITCHING_SO, y = TARGET_WINS)) +
  geom_point() + geom_smooth()


plot_grid(gs1, gs2, labels = "AUTO")
plot_grid(gs3, gs4, labels = "AUTO")
plot_grid(gs5, gs6, labels = "AUTO")
plot_grid(gs7, gs8, labels = "AUTO")
plot_grid(gs9, gs10, labels = "AUTO")
plot_grid(gs11, gs12, labels = "AUTO")
plot_grid(gs13, gs14, labels = "AUTO")
plot_grid(gs15, labels = "AUTO")


```

Plotting the box plot to see the data ranges for each of the numeric variables:
```{r}
gb1 <- ggplot(data = moneyball_df, aes(y = TARGET_WINS)) + geom_boxplot()
gb2 <- ggplot(data = moneyball_df, aes(y = TEAM_BATTING_H)) + geom_boxplot()
plot_grid(gb1, gb2, labels = "AUTO")

gb3 <- ggplot(data = moneyball_df, aes(y = TEAM_BATTING_2B)) + geom_boxplot()
gb4 <- ggplot(data = moneyball_df, aes(y = TEAM_BATTING_3B)) + geom_boxplot()
plot_grid(gb3, gb4, labels = "AUTO")

gb5 <- ggplot(data = moneyball_df, aes(y = TEAM_BATTING_HR)) + geom_boxplot()
gb6 <- ggplot(data = moneyball_df, aes(y = TEAM_BATTING_BB)) + geom_boxplot()
plot_grid(gb5, gb6, labels = "AUTO")

gb7 <- ggplot(data = moneyball_df, aes(y = TEAM_BATTING_HBP)) + geom_boxplot()
gb8 <- ggplot(data = moneyball_df, aes(y = TEAM_BATTING_SO)) + geom_boxplot()
plot_grid(gb7, gb8, labels = "AUTO")

gb9 <- ggplot(data = moneyball_df, aes(y = TEAM_BASERUN_SB)) + geom_boxplot()
gb10 <- ggplot(data = moneyball_df, aes(y = TEAM_BASERUN_CS)) + geom_boxplot()
plot_grid(gb9, gb10, labels = "AUTO")

gb11 <- ggplot(data = moneyball_df, aes(y = TEAM_FIELDING_E)) + geom_boxplot()
gb12 <- ggplot(data = moneyball_df, aes(y = TEAM_FIELDING_DP)) + geom_boxplot()
plot_grid(gb11, gb12, labels = "AUTO")

gb13 <- ggplot(data = moneyball_df, aes(y = TEAM_PITCHING_BB)) + geom_boxplot()
gb14 <- ggplot(data = moneyball_df, aes(y = TEAM_PITCHING_H)) + geom_boxplot()
plot_grid(gb13, gb14, labels = "AUTO")

gb15 <- ggplot(data = moneyball_df, aes(y = TEAM_PITCHING_HR)) + geom_boxplot()
gb16 <- ggplot(data = moneyball_df, aes(y = TEAM_PITCHING_SO)) + geom_boxplot()
plot_grid(gb15, gb16, labels = "AUTO")
```

Plotting the histogram for the dependent variable:
```{r}
### Histograms:
ggplot(data = moneyball_df, aes(x = TARGET_WINS)) + geom_histogram() +
  geom_vline(aes(xintercept=mean(TARGET_WINS)), 
             color='blue', linetype='dashed', size=1)
```

Removing the feature: TEAM_BATTING_HBP as it is missing for 91% of the observations
```{r}
moneyball_df_model  <- moneyball_df %>% select(-TEAM_BATTING_HBP)
```

Plotting the missing data pattern:
```{r}
aggr_plot <- aggr(moneyball_df_model, col=c('navyblue','red'), 
                  numbers=TRUE, sortVars=TRUE, 
                  labels=names(data), cex.axis=.7, gap=3, 
                  ylab=c("Histogram of missing data","Pattern"))

```

Imputing the missing data for the other 4 features, which we are keeping for our analysis:
```{r}
moneyball_df_model_imputed <- mice(data = moneyball_df_model, m = 1,
                                   method = "pmm", maxit = 5, seed = 500)

moneyball_df_model_imputed_df1 <- mice::complete(moneyball_df_model_imputed, 1)
```

Now, our new dataframe has all the values imputed.

Starting with the model preparation.
```{r}
g1 <- lm(TARGET_WINS ~TEAM_BATTING_H + TEAM_BATTING_2B + TEAM_BATTING_3B +
           TEAM_BATTING_HR + TEAM_BATTING_BB + TEAM_BATTING_SO + 
           TEAM_BASERUN_SB + TEAM_BASERUN_CS + TEAM_PITCHING_H +
           TEAM_PITCHING_HR + TEAM_PITCHING_BB + TEAM_PITCHING_SO +
           TEAM_FIELDING_E + TEAM_FIELDING_DP, data = moneyball_df_model_imputed_df1)

summary(g1)
```

By looking at the p-values of individual features, we have to remove 3 for now:
TEAM_BATTING_3B, TEAM_BASERUN_CS, TEAM_PITCHING_HR

```{r}
g2 <- lm(TARGET_WINS ~TEAM_BATTING_H + TEAM_BATTING_2B +
           TEAM_BATTING_HR + TEAM_BATTING_BB + TEAM_BATTING_SO + 
           TEAM_BASERUN_SB + TEAM_PITCHING_H + TEAM_PITCHING_BB + TEAM_PITCHING_SO +
           TEAM_FIELDING_E + TEAM_FIELDING_DP, data = moneyball_df_model_imputed_df1)

summary(g2)
```

